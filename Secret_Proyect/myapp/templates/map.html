{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DenunciAPP - Mapa</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/map.css' %}" />
    <script type="module" src="{% static 'js/map.js' %}"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script>
      let map;

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: {lat: -34.397, lng: 150.644},
          zoom: 8,
          mapId: 'aabacebd5b1b5d90'
        });

        infoWindow = new google.maps.InfoWindow({
          content: ""
        });

        const script = document.createElement("script");

        script.setAttribute(
          "src",
          "{% static 'json/archivo_test.json' %}"
        );
        document.getElementsByTagName("head")[0].appendChild(script);
      }
      function eqfeed_callback(results) {

        for (let i = 0; i < results.features.length; i++) {
          const coords = results.features[i].geometry.coordinates;
          
          const latLng = new google.maps.LatLng(coords[1], coords[0]);
          const marker = new google.maps.Marker({
            position: latLng,
            map: map,
          });
          
          const f = results.features[i].properties;
          
          marker.addListener("click", (e) => {
            const d = new Date(0);
            d.setUTCMilliseconds(f.time);
            
            const contentString = 
              '<div class="info-window-content">'+
              '<h2>'+f.place +'</h2>'+
              '<h3>Magnitude '+f.mag+'</h3><p>'+d.toString()+'</p>'+
              '<a href="'+f.url+'" target="new">View on USGS</a>'+
              '</div>';
            
            infoWindow.setContent(contentString);
            infoWindow.open({
              anchor: marker,
              map,
              shouldFocus: false, 
            });
            
          });
        }
      }

      window.initMap = initMap;
      window.eqfeed_callback = eqfeed_callback;
    </script>
    <style>
      #map {
        height: 700px;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      h2{
        margin-top: 0;
      }

      .info-window-content{
        padding: 8px;
      }
    </style>
</head>
<body>
  <header>
    <h1>DenunciAPP</h1>
</header>
<nav>
    <ul>
        <li><a href="/">Inicio</a></li>
        <li><a href="/sobre-denunciapp/">Sobre DenunciAPP</a></li>
        <li><a href="/formulario/">Formulario</a></li>
        <li><a href="/mapa/">Mapa</a></li>
    </ul>
</nav>
    <br/>
    <div id="map"></div>
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBa_xoUht1mXl6xz1J4aMH3DUeEOfjG_5Y&callback=initMap&v=weekly"
    defer
  ></script>
</body>
</html>